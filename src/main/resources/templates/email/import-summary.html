<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Import TCG - Riepilogo</title>
    <!--[if mso]>
    <style type="text/css">
        table { border-collapse: collapse; }
        .stat-cell { padding: 16px !important; }
    </style>
    <![endif]-->
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f3f4f6; -webkit-font-smoothing: antialiased;">

    <!-- Wrapper Table -->
    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f3f4f6;">
        <tr>
            <td align="center" style="padding: 24px 16px;">

                <!-- Main Container -->
                <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="max-width: 480px; background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">

                    <!-- Status Header -->
                    <tr>
                        <td th:style="${'padding: 32px 24px; text-align: center; background: linear-gradient(135deg, ' + (status == 'SUCCESS' ? '#10b981 0%, #059669 100%' : status == 'FAILED' ? '#ef4444 0%, #dc2626 100%' : '#f59e0b 0%, #d97706 100%') + ');'}">

                            <!-- Status Icon -->
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td align="center" style="padding-bottom: 16px;">
                                        <div th:if="${status == 'SUCCESS'}" style="width: 64px; height: 64px; background-color: rgba(255,255,255,0.2); border-radius: 50%; display: inline-block; line-height: 64px; font-size: 32px;">
                                            &#10003;
                                        </div>
                                        <div th:if="${status == 'FAILED'}" style="width: 64px; height: 64px; background-color: rgba(255,255,255,0.2); border-radius: 50%; display: inline-block; line-height: 64px; font-size: 32px;">
                                            &#10007;
                                        </div>
                                        <div th:if="${status != 'SUCCESS' and status != 'FAILED'}" style="width: 64px; height: 64px; background-color: rgba(255,255,255,0.2); border-radius: 50%; display: inline-block; line-height: 64px; font-size: 32px;">
                                            !
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="center">
                                        <h1 style="margin: 0; color: #ffffff; font-size: 22px; font-weight: 700; line-height: 1.3;"
                                            th:text="${status == 'SUCCESS' ? 'Import Completato' : status == 'FAILED' ? 'Import Fallito' : 'Import Parziale'}">
                                            Import Completato
                                        </h1>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="center" style="padding-top: 8px;">
                                        <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 15px;">
                                            Durata: <strong th:text="${durationMinutes}">5</strong> minuti
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Greeting -->
                    <tr>
                        <td style="padding: 28px 24px 0 24px;">
                            <p style="margin: 0; font-size: 16px; color: #374151; line-height: 1.5;">
                                Ciao <strong style="color: #111827;" th:text="${username}">User</strong>,
                            </p>
                            <p style="margin: 8px 0 0 0; font-size: 15px; color: #6b7280; line-height: 1.5;">
                                Ecco il riepilogo dell'import notturno dalla tua collezione JustTCG.
                            </p>
                        </td>
                    </tr>

                    <!-- Stats Cards - 2x2 Grid using Tables -->
                    <tr>
                        <td style="padding: 24px 16px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                <!-- Row 1 -->
                                <tr>
                                    <td width="50%" style="padding: 6px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f9fafb; border-radius: 12px; border: 1px solid #e5e7eb;">
                                            <tr>
                                                <td align="center" style="padding: 20px 12px;">
                                                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: #111827; line-height: 1;" th:text="${totalCards}">150</p>
                                                    <p style="margin: 6px 0 0 0; font-size: 13px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Totali</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="50%" style="padding: 6px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #ecfdf5; border-radius: 12px; border: 1px solid #a7f3d0;">
                                            <tr>
                                                <td align="center" style="padding: 20px 12px;">
                                                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: #059669; line-height: 1;">
                                                        +<span th:text="${cardsAdded}">45</span>
                                                    </p>
                                                    <p style="margin: 6px 0 0 0; font-size: 13px; color: #047857; text-transform: uppercase; letter-spacing: 0.5px;">Nuove</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <!-- Row 2 -->
                                <tr>
                                    <td width="50%" style="padding: 6px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #eff6ff; border-radius: 12px; border: 1px solid #bfdbfe;">
                                            <tr>
                                                <td align="center" style="padding: 20px 12px;">
                                                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: #2563eb; line-height: 1;" th:text="${cardsUpdated}">12</p>
                                                    <p style="margin: 6px 0 0 0; font-size: 13px; color: #1d4ed8; text-transform: uppercase; letter-spacing: 0.5px;">Aggiornate</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                    <td width="50%" style="padding: 6px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f9fafb; border-radius: 12px; border: 1px solid #e5e7eb;">
                                            <tr>
                                                <td align="center" style="padding: 20px 12px;">
                                                    <p style="margin: 0; font-size: 32px; font-weight: 700; color: #9ca3af; line-height: 1;" th:text="${cardsSkipped}">3</p>
                                                    <p style="margin: 6px 0 0 0; font-size: 13px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">Saltate</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- TCG Details Section -->
                    <tr th:if="${summary.tcgResults != null and !summary.tcgResults.isEmpty()}">
                        <td style="padding: 0 24px;">
                            <!-- Section Header -->
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="border-bottom: 2px solid #e5e7eb; margin-bottom: 16px;">
                                <tr>
                                    <td style="padding-bottom: 12px;">
                                        <h2 style="margin: 0; font-size: 17px; font-weight: 700; color: #111827;">
                                            Dettagli per TCG
                                        </h2>
                                    </td>
                                </tr>
                            </table>

                            <!-- TCG Cards -->
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" th:each="tcgResult : ${summary.tcgResults}">
                                <tr>
                                    <td style="padding: 16px 0; border-bottom: 1px solid #f3f4f6;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                            <!-- TCG Name + Status -->
                                            <tr>
                                                <td>
                                                    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                                        <tr>
                                                            <td style="font-size: 16px; font-weight: 600; color: #111827;" th:text="${tcgResult.tcgDisplayName}">
                                                                Magic: The Gathering
                                                            </td>
                                                            <td align="right" width="40">
                                                                <span th:if="${tcgResult.status == 'SUCCESS'}" style="font-size: 20px;">&#9989;</span>
                                                                <span th:if="${tcgResult.status == 'FAILED'}" style="font-size: 20px;">&#10060;</span>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <!-- TCG Stats Row -->
                                            <tr>
                                                <td style="padding-top: 10px;">
                                                    <table role="presentation" cellpadding="0" cellspacing="0" border="0">
                                                        <tr>
                                                            <td style="padding-right: 24px;">
                                                                <span style="font-size: 13px; color: #6b7280;">Processate: </span>
                                                                <span style="font-size: 14px; font-weight: 600; color: #111827;" th:text="${tcgResult.cardsProcessed}">50</span>
                                                            </td>
                                                            <td style="padding-right: 24px;">
                                                                <span style="font-size: 13px; color: #6b7280;">Nuove: </span>
                                                                <span style="font-size: 14px; font-weight: 600; color: #10b981;" th:text="${tcgResult.cardsAdded}">15</span>
                                                            </td>
                                                            <td>
                                                                <span style="font-size: 13px; color: #6b7280;">Durata: </span>
                                                                <span style="font-size: 14px; font-weight: 600; color: #111827;"><span th:text="${tcgResult.durationMinutes}">2</span>m</span>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                            <!-- Error if present -->
                                            <tr th:if="${tcgResult.errorMessage != null and !tcgResult.errorMessage.isEmpty()}">
                                                <td style="padding-top: 10px;">
                                                    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #fef2f2; border-radius: 8px; border-left: 3px solid #ef4444;">
                                                        <tr>
                                                            <td style="padding: 10px 12px; font-size: 13px; color: #991b1b;">
                                                                <strong>Errore:</strong> <span th:text="${tcgResult.errorMessage}">Error message</span>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Error Alert -->
                    <tr th:if="${errors != null and errors > 0}">
                        <td style="padding: 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #fef2f2; border-radius: 12px; border: 1px solid #fecaca;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                <td width="40" valign="top">
                                                    <span style="font-size: 24px;">&#9888;</span>
                                                </td>
                                                <td>
                                                    <p style="margin: 0; font-size: 15px; font-weight: 600; color: #991b1b;">
                                                        <span th:text="${errors}">2</span> errori riscontrati
                                                    </p>
                                                    <p th:if="${errorMessage}" style="margin: 6px 0 0 0; font-size: 14px; color: #b91c1c;" th:text="${errorMessage}">
                                                        Error details here
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Collection Changes (Deltas) -->
                    <tr th:if="${deltas != null and !deltas.isEmpty()}">
                        <td style="padding: 8px 24px 24px 24px;">
                            <!-- Section Header -->
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="border-bottom: 2px solid #e5e7eb; margin-bottom: 8px;">
                                <tr>
                                    <td style="padding-bottom: 12px;">
                                        <h2 style="margin: 0; font-size: 17px; font-weight: 700; color: #111827;">
                                            Modifiche alla Collezione
                                        </h2>
                                    </td>
                                </tr>
                            </table>

                            <!-- Delta Items -->
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                <tr th:each="delta : ${deltas}">
                                    <td style="padding: 14px 0; border-bottom: 1px solid #f3f4f6;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                <td>
                                                    <p style="margin: 0; font-size: 15px; font-weight: 600; color: #111827;" th:text="${delta.cardName}">Charizard V</p>
                                                    <p style="margin: 3px 0 0 0; font-size: 13px; color: #6b7280;" th:text="${delta.setName}">Brilliant Stars</p>
                                                </td>
                                                <td align="right" valign="middle">
                                                    <!-- ADDED -->
                                                    <span th:if="${delta.changeType == 'ADDED'}" style="display: inline-block; background-color: #ecfdf5; color: #059669; font-size: 14px; font-weight: 600; padding: 6px 12px; border-radius: 20px;">
                                                        +<span th:text="${delta.quantityAfter}">3</span> nuove
                                                    </span>
                                                    <!-- INCREASED -->
                                                    <span th:if="${delta.changeType == 'INCREASED'}" style="display: inline-block; background-color: #eff6ff; color: #2563eb; font-size: 14px; font-weight: 600; padding: 6px 12px; border-radius: 20px;">
                                                        <span th:text="${delta.quantityBefore}">2</span> &#8594; <span th:text="${delta.quantityAfter}">5</span>
                                                    </span>
                                                    <!-- DECREASED -->
                                                    <span th:if="${delta.changeType == 'DECREASED'}" style="display: inline-block; background-color: #fffbeb; color: #d97706; font-size: 14px; font-weight: 600; padding: 6px 12px; border-radius: 20px;">
                                                        <span th:text="${delta.quantityBefore}">5</span> &#8594; <span th:text="${delta.quantityAfter}">2</span>
                                                    </span>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Info Box -->
                    <tr>
                        <td style="padding: 0 24px 24px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #f3f4f6; border-radius: 12px;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                <td width="36" valign="top">
                                                    <span style="font-size: 20px;">&#128337;</span>
                                                </td>
                                                <td>
                                                    <p style="margin: 0; font-size: 14px; color: #4b5563; line-height: 1.5;">
                                                        <strong style="color: #111827;">Prossimo import:</strong> Ogni notte alle 3:00 AM la tua collezione viene sincronizzata automaticamente con JustTCG.
                                                    </p>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="padding: 24px; background-color: #111827; text-align: center;">
                            <p style="margin: 0; font-size: 13px; color: #9ca3af;">
                                TCG Arena &bull; Email automatica
                            </p>
                            <p style="margin: 8px 0 0 0; font-size: 12px; color: #6b7280;">
                                &copy; 2026 TCG Arena
                            </p>
                        </td>
                    </tr>

                </table>

            </td>
        </tr>
    </table>

</body>
</html>
